#include <stdio.h>
#include <unistd.h>

#include "layers/matrix.h"
#include "layers/lstm.h"
float lstm_1_kernel_weights[] = {-0.11138653755187988281, 0.22896693646907806396, -0.60296922922134399414, 0.43992856144905090332, 0.47826248407363891602, 0.03746636584401130676, -0.44716590642929077148, 0.10910264402627944946, 0.41209378838539123535, -0.10412748157978057861, 0.13623058795928955078, -0.71828263998031616211,};
struct matrix_f lstm_1_kernel = {.x=1, .y=12, .data=lstm_1_kernel_weights};
float lstm_1_recurrent_kernel_weights[] = {-0.26069098711013793945, -0.20290280878543853760, 0.21663579344749450684, -1.03014004230499267578, -0.19240644574165344238, 0.22681766748428344727, -0.07238705456256866455, -0.39520812034606933594, -0.21552993357181549072, -0.44515779614448547363, -0.62176918983459472656, 0.47965675592422485352, 0.22313055396080017090, 0.37778404355049133301, -0.45542836189270019531, 0.17161339521408081055, 0.16404472291469573975, 0.03692549839615821838, 0.01016489416360855103, 0.03992509096860885620, 0.34017980098724365234, 0.08782042562961578369, 0.00042673543794080615, 0.35722169280052185059, 0.12200673669576644897, 0.38269796967506408691, -0.61351704597473144531, 0.44893917441368103027, 0.14856140315532684326, -0.58848321437835693359, -0.02343891002237796783, -0.38541454076766967773, 0.23298323154449462891, -0.23381271958351135254, 0.29147616028785705566, -0.61018073558807373047,};
struct matrix_f lstm_1_recurrent_kernel = {.x=3, .y=12, .data=lstm_1_recurrent_kernel_weights};
float lstm_1_bias_weights[] = {0.10178969800472259521, 0.36655518412590026855, 0.11918659508228302002, 1.09498453140258789062, 1.25383174419403076172, 1.10266816616058349609, 0.13135625422000885010, 0.08208376914262771606, 0.19616332650184631348, 0.38030767440795898438, 0.38460430502891540527, 0.17582342028617858887,};
struct matrix_f lstm_1_bias = {.x=1, .y=12, .data=lstm_1_bias_weights};
struct lstm_layer lstm_1 = {.kernel=&lstm_1_kernel, .recurrent_kernel=&lstm_1_recurrent_kernel, .bias=&lstm_1_bias, .input_x=1, .input_y=1, .output_x=1, .output_y=3, .return_sequences=true};
float lstm_2_kernel_weights[] = {-0.11138653755187988281, 0.22896693646907806396, -0.60296922922134399414, 0.43992856144905090332, 0.47826248407363891602, 0.03746636584401130676, -0.44716590642929077148, 0.10910264402627944946, 0.41209378838539123535, -0.10412748157978057861, 0.13623058795928955078, -0.71828263998031616211,};
struct matrix_f lstm_2_kernel = {.x=1, .y=12, .data=lstm_2_kernel_weights};
float lstm_2_recurrent_kernel_weights[] = {-0.26069098711013793945, -0.20290280878543853760, 0.21663579344749450684, -1.03014004230499267578, -0.19240644574165344238, 0.22681766748428344727, -0.07238705456256866455, -0.39520812034606933594, -0.21552993357181549072, -0.44515779614448547363, -0.62176918983459472656, 0.47965675592422485352, 0.22313055396080017090, 0.37778404355049133301, -0.45542836189270019531, 0.17161339521408081055, 0.16404472291469573975, 0.03692549839615821838, 0.01016489416360855103, 0.03992509096860885620, 0.34017980098724365234, 0.08782042562961578369, 0.00042673543794080615, 0.35722169280052185059, 0.12200673669576644897, 0.38269796967506408691, -0.61351704597473144531, 0.44893917441368103027, 0.14856140315532684326, -0.58848321437835693359, -0.02343891002237796783, -0.38541454076766967773, 0.23298323154449462891, -0.23381271958351135254, 0.29147616028785705566, -0.61018073558807373047,};
struct matrix_f lstm_2_recurrent_kernel = {.x=3, .y=12, .data=lstm_2_recurrent_kernel_weights};
float lstm_2_bias_weights[] = {0.10178969800472259521, 0.36655518412590026855, 0.11918659508228302002, 1.09498453140258789062, 1.25383174419403076172, 1.10266816616058349609, 0.13135625422000885010, 0.08208376914262771606, 0.19616332650184631348, 0.38030767440795898438, 0.38460430502891540527, 0.17582342028617858887,};
struct matrix_f lstm_2_bias = {.x=1, .y=12, .data=lstm_2_bias_weights};
struct lstm_layer lstm_2 = {.kernel=&lstm_2_kernel, .recurrent_kernel=&lstm_2_recurrent_kernel, .bias=&lstm_2_bias, .input_x=1, .input_y=1, .output_x=1, .output_y=3, .return_sequences=false};

int main() {
	float input_data[] = {0.003};
	float input_data_2[] = {0.002};
	float input_data_3[] = {1.0};
	struct matrix_f input_mat = {.x=1, .y=1, .data=input_data};
	struct matrix_f input_mat_2 = {.x=1, .y=1, .data=input_data_2};
	struct matrix_f input_mat_3 = {.x=1, .y=1, .data=input_data_3};
	
	struct lstm_sequence_io_node input_3 = {.next=NULL, .data=&input_mat_3};
	struct lstm_sequence_io_node input_2 = {.next=&input_3, .data=&input_mat_2};
	struct lstm_sequence_io_node input = {.next=&input_2, .data=&input_mat};
	
	struct lstm_sequence_io_node result = {0};
	//struct lstm_sequence_io_node result_2 = {0};
	result = LSTMLayer(lstm_1, &input);
	//result_2 = LSTMLayer(lstm_2, &result);
	usleep(5); //Used as a breakpoint.
	struct lstm_sequence_io_node *p = &result;

	while(p != NULL) {
		print_mat(*(p->data));
		p = p->next;
	}
}